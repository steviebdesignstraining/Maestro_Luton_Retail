name: Android UI Tests with Maestro

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  maestro-test:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download APK from GitHub Release
      uses: dsaltares/fetch-gh-release-asset@master
      with:
        repo: steviebdesignstraining/Maestro_Luton_Retail
        tag: v1.0.0
        file: LutonRetail.apk
        token: ${{ secrets.GITHUB_TOKEN }}
        target: app.apk

    - name: Run Maestro tests using GitHub Action
      uses: mobile-dev-inc/action-maestro-cloud@v1
      with:
        appId: app.apk
        flow: .maestro    # Adjust if your Maestro folder has a different name

    - name: Upload Maestro Test Output
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: maestro-test-output
        path: .maestro/output/
